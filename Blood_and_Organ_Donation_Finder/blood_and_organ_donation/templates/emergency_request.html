{% extends 'base.html' %}
{% load static %}

{% block title %}Emergency Request{% endblock %}

{% block sub_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'emergency_request.css' %}">
{% endblock %}

{% block hero %}
<section class="hero">
  <h1>ðŸš¨ Emergency Request</h1>
  <p>Nearby donors will be notified immediately</p>
</section>
{% endblock %}

{% block body %}
<div class="container col-lg-7 col-md-9 mt-n5">
  <div class="card-glass p-4">

    <form method="post" action="/emergency_request/" enctype="multipart/form-data">
      {% csrf_token %}

      <input type="hidden" name="priority" value="emergency">
      <input type="hidden" name="request_type" id="emergency_request_type" value="blood">

      <!-- Request Type -->
      <h4 class="fw-bold text-center mb-3">Request Type</h4>
      <div class="d-flex justify-content-center gap-3 mb-4">
        <button type="button" class="btn tab-btn active"
                onclick="selectType('blood', this)">Blood</button>

        <button type="button" class="btn tab-btn"
                onclick="selectType('organ', this)">Organ</button>
      </div>

      <!-- Patient Details -->
      <h5 class="fw-bold mb-3">Patient Details</h5>
      <div class="row g-3">
        <input class="form-control" name="full_name" placeholder="Full Name" required>
        <input class="form-control" name="aadhar_id" placeholder="Aadhar ID" maxlength="12" required>

        <input type="date" class="form-control" name="dob" id="dob" onchange="calculateAge()" required>
        <input class="form-control" name="age" id="age" placeholder="Age" readonly>

        <select class="form-select" name="gender" required>
          <option value="">Gender</option>
          <option value="M">Male</option>
          <option value="F">Female</option>
          <option value="O">Other</option>
          <option value="PNS">Prefer Not Say</option>
        </select>

        <input class="form-control" name="city" placeholder="City" required>
        <input class="form-control" name="phone" placeholder="Emergency Contact" required>
      </div>

      <!-- Blood -->
      <div id="bloodSection" class="mt-3">
        <select class="form-select" name="blood_group">
          <option value="">Required Blood Group</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
        </select>
      </div>

      <!-- Organ -->
      <div id="organSection" class="hidden mt-3">
        <select class="form-select" name="organ">
          <option value="">Required Organ</option>
            <option value="Kidney">Kidney</option>
            <option value="Liver">Liver</option>
            <option value="Lungs">Lungs</option>
            <option value="Heart">Heart</option>
            <option value="Pancreas">Pancreas</option>
            <option value="Intestine">Intestine</option>
            <option value="Uterus">Uterus</option>
            <option value="Eyes">Eyes</option>
            <option value="Tissues">Tissues</option>
        </select>
      </div>

      <!-- Medical Info -->
      <input class="form-control mt-3" name="weight" placeholder="Weight (kg)" required>
      <input class="form-control mt-3" name="medical_condition"
             placeholder="Medical Condition (optional)">

      <label class="form-label mt-3">Doctor Report</label>
      <input type="file" class="form-control" name="doc_report" required>

      <!-- Consent -->
      <div class="form-check mt-4">
        <input class="form-check-input" type="checkbox" required>
        <label class="form-check-label">
          I confirm this is a genuine medical emergency.
        </label>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-danger px-5">
           Send Emergency Request
        </button>
      </div>

    </form>
  </div>
</div>

<script src="{% static 'emergency_request.js' %}"></script>
{% endblock %}
